@page "/customers"
@inject CascadeWebApp.Services.CustomerService CustomerService

<div class="pa-4 mud-theme-dark">
    <h5>Customer List</h5>
    <input class="mb-2" placeholder="Searchâ€¦" @bind="_search" />
    <div class="table-scroll">
        <table class="app-table">
            <thead>
                <tr>
                    <th>Studio</th>
                    <th>Email</th>
                    <th>Phone #</th>
                    <th>Discount Level</th>
                    <th>Payment Terms</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var customer in _filteredCustomers)
                {
                    <tr @onclick="() => OpenCustomerModal(customer)">
                        <td>@customer.Studio</td>
                        <td>@customer.Email</td>
                        <td>@customer.Phone</td>
                        <td>@customer.DiscountLevel</td>
                        <td>@customer.PaymentTerms</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@if (_showModal && _selectedCustomer != null)
{
    <div class="modal-backdrop" @onclick="CloseModal"></div>
    <div class="modal-dialog">
        <div class="modal-header">
            <h5>Customer Details - @_selectedCustomer.Studio</h5>
            <button type="button" class="close" @onclick="CloseModal">&times;</button>
        </div>
        <div class="modal-body">
            <div>Studio: @_selectedCustomer.Studio</div>
            <div>Email: @_selectedCustomer.Email</div>
            <div>Phone #: @_selectedCustomer.Phone</div>
            <div>Discount Level: @_selectedCustomer.DiscountLevel</div>
            <div>Payment Terms: @_selectedCustomer.PaymentTerms</div>
            <div>Contact First Name: @_selectedCustomer.ContactFirstName</div>
            <div>Contact Second Name: @_selectedCustomer.ContactSecondName</div>
            <div>Shipping Address Line 1: @_selectedCustomer.ShippingAddressLine1</div>
            <div>Shipping Address Line 2: @_selectedCustomer.ShippingAddressLine2</div>
            <div>Shipping City: @_selectedCustomer.ShippingCity</div>
            <div>Shipping State: @_selectedCustomer.ShippingState</div>
            <div>Shipping Zip: @_selectedCustomer.ShippingZip</div>
            <div>Shipping Country: @_selectedCustomer.ShippingCountry</div>
            <div>Billing Address Line 1: @_selectedCustomer.BillingAddressLine1</div>
            <div>Billing Address Line 2: @_selectedCustomer.BillingAddressLine2</div>
            <div>Billing City: @_selectedCustomer.BillingCity</div>
            <div>Billing State: @_selectedCustomer.BillingState</div>
            <div>Billing Zip: @_selectedCustomer.BillingZip</div>
            <div>Billing Country: @_selectedCustomer.BillingCountry</div>
            <div class="table-scroll">
                <table class="app-table">
                    <thead>
                        <tr>
                            <th>Order #</th>
                            <th>Order Date</th>
                            <th>Studio</th>
                            <th>Est Ship Date</th>
                            <th>Shipping Deadline</th>
                            <th>Shipping Method</th>
                            <th>Partial</th>
                            <th>Order Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SampleOrder</td>
                            <td>2025-08-17</td>
                            <td>@_selectedCustomer.Studio</td>
                            <td>2025-08-20</td>
                            <td>2025-08-21</td>
                            <td>UPS</td>
                            <td>Yes</td>
                            <td>Processing</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" @onclick="CloseModal">Close</button>
        </div>
    </div>
}

@code {
    private string _search = "";
    private List<CascadeWebApp.Models.Customer> _customers = new();
    private IEnumerable<CascadeWebApp.Models.Customer> _filteredCustomers => string.IsNullOrWhiteSpace(_search)
        ? _customers
        : _customers.Where(c => c.Studio.Contains(_search, StringComparison.OrdinalIgnoreCase));
    private CascadeWebApp.Models.Customer? _selectedCustomer;
    private bool _showModal = false;

    protected override async Task OnInitializedAsync()
    {
        _customers = await CustomerService.GetCustomersAsync();
    }

    private void OpenCustomerModal(CascadeWebApp.Models.Customer customer)
    {
        _selectedCustomer = customer;
        _showModal = true;
    }

    private void CloseModal()
    {
        _showModal = false;
        _selectedCustomer = null;
    }
}