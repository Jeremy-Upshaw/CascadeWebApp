@page "/items"
@inject CascadeWebApp.Services.ItemService ItemService

<div class="pa-4" style="background: #222; color: #fff;">
    <h5 class="table-page-title">Item List</h5>
    <div class="search-container">
        <input class="search-input" placeholder="Search itemsâ€¦" @bind="_search" />
        <button class="search-toggle-icon" title="Toggle search">
            <i class="material-icons">search</i>
        </button>
    </div>
    <div class="table-container">
        <div class="table-scroll">
            <table class="app-table">
            <thead>
                <tr>
                    <th>Item #</th>
                    <th>Thread</th>
                    <th>Gauge</th>
                    <th>End Type</th>
                    <th>End MM</th>
                    <th>End Inch</th>
                    <th>Length</th>
                    <th>On Order</th>
                    <th>In Production</th>
                    <th>On the Wall</th>
                    <th>In the Shop</th>
                    <th>Available</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in _filteredItems)
                {
                    <tr @onclick="() => OpenItemModal(item)">
                        <td>@item.ItemNumber</td>
                        <td>@item.Thread</td>
                        <td>@item.Gauge</td>
                        <td>@item.EndType</td>
                        <td>@item.EndMM</td>
                        <td>@item.EndInch</td>
                        <td>@item.Length</td>
                        <td>@item.OnOrder</td>
                        <td>@item.InProduction</td>
                        <td>@item.OnTheWall</td>
                        <td>@item.InTheShop</td>
                        <td>@item.Available</td>
                    </tr>
                }
            </tbody>
        </table>
        </div>
    </div>
</div>

@if (_showModal && _selectedItem != null)
{
    <div class="modal-backdrop" @onclick="CloseModal"></div>
    <div class="modal-dialog">
        <!-- Floating close button -->
        <button type="button" class="modal-close-floating" @onclick="CloseModal">&times;</button>
        
        <div class="modal-body">
            <!-- Title field - Item Number centered without label -->
            <div class="modal-detail-title">@_selectedItem.ItemNumber</div>
            
            <div class="modal-details">
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Thread</div>
                    <div class="modal-detail-value">@_selectedItem.Thread</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Gauge</div>
                    <div class="modal-detail-value">@_selectedItem.Gauge</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">End Type</div>
                    <div class="modal-detail-value">@_selectedItem.EndType</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">End MM</div>
                    <div class="modal-detail-value">@_selectedItem.EndMM</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">End Inch</div>
                    <div class="modal-detail-value">@_selectedItem.EndInch</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Length</div>
                    <div class="modal-detail-value">@_selectedItem.Length</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">On Order</div>
                    <div class="modal-detail-value">@_selectedItem.OnOrder</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">In Production</div>
                    <div class="modal-detail-value">@_selectedItem.InProduction</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">On the Wall</div>
                    <div class="modal-detail-value">@_selectedItem.OnTheWall</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">In the Shop</div>
                    <div class="modal-detail-value">@_selectedItem.InTheShop</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Available</div>
                    <div class="modal-detail-value">@_selectedItem.Available</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Machining Length</div>
                    <div class="modal-detail-value">@_selectedItem.MachiningLength</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Cycle Time</div>
                    <div class="modal-detail-value">@_selectedItem.CycleTime</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Stock Qty</div>
                    <div class="modal-detail-value">@_selectedItem.StockQty</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Build Qty</div>
                    <div class="modal-detail-value">@_selectedItem.BuildQty</div>
                </div>
                <div class="modal-detail-field">
                    <div class="modal-detail-label">Min Stock Size</div>
                    <div class="modal-detail-value">@_selectedItem.MinStockSize</div>
                </div>
            </div>
            <div class="table-scroll">
                <table class="app-table">
                    <thead>
                        <tr>
                            <th>Batch #</th>
                            <th>Date Finished</th>
                            <th>Assign 1</th>
                            <th>Qty 1</th>
                            <th>Assign (Action)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SampleBatch</td>
                            <td>2025-08-17</td>
                            <td>Assignee</td>
                            <td>10</td>
                            <td>
                                <button class="btn btn-primary" disabled>Assign</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" @onclick="CloseModal">Close</button>
        </div>
    </div>
}

@code {
    private string _search = "";
    private List<CascadeWebApp.Models.Item> _items = new();
    private IEnumerable<CascadeWebApp.Models.Item> _filteredItems => string.IsNullOrWhiteSpace(_search)
        ? _items
        : _items.Where(i => i.ItemNumber.Contains(_search, StringComparison.OrdinalIgnoreCase));
    private CascadeWebApp.Models.Item? _selectedItem;
    private bool _showModal = false;

    protected override async Task OnInitializedAsync()
    {
        _items = await ItemService.GetItemsAsync();
    }

    private void OpenItemModal(CascadeWebApp.Models.Item item)
    {
        _selectedItem = item;
        _showModal = true;
    }

    private void CloseModal()
    {
        _showModal = false;
        _selectedItem = null;
    }
}