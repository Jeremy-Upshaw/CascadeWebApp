<!-- Material Admin Pro drawer navigation -->
<nav class="drawer accordion drawer-dark bg-dark text-light" id="drawerAccordion">
    <div class="drawer-menu">
        <div class="nav">
            <!-- Home/Dashboard -->
            <NavLink class="nav-link text-light" href="/" Match="NavLinkMatch.All">
                Home
            </NavLink>

            <!-- Items with sub-links -->
            <div class="nav-item-group">
                <NavLink class="nav-link text-light collapsible-nav-link" href="items" @onclick='() => ToggleSubMenu("items")'>
                    Items
                </NavLink>
                <div class="sub-menu @(IsSubMenuOpen("items") ? "sub-menu-open" : "")">
                    <NavLink class="nav-link text-light sub-nav-link" href="items/threadless">
                        Threadless
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="items/threaded">
                        Threaded
                    </NavLink>
                </div>
            </div>

            <!-- Orders with sub-links -->
            <div class="nav-item-group">
                <NavLink class="nav-link text-light collapsible-nav-link" href="orders" @onclick='() => ToggleSubMenu("orders")'>
                    Orders
                </NavLink>
                <div class="sub-menu @(IsSubMenuOpen("orders") ? "sub-menu-open" : "")">
                    <NavLink class="nav-link text-light sub-nav-link" href="orders/shopify">
                        Shopify Orders
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="orders/pulllist">
                        Pull List
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="orders/labels">
                        Labels
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="orders/assign">
                        Assign
                    </NavLink>
                </div>
            </div>

            <!-- Customers with sub-links -->
            <div class="nav-item-group">
                <NavLink class="nav-link text-light collapsible-nav-link" href="customers" @onclick='() => ToggleSubMenu("customers")'>
                    Customers
                </NavLink>
                <div class="sub-menu @(IsSubMenuOpen("customers") ? "sub-menu-open" : "")">
                    <NavLink class="nav-link text-light sub-nav-link" href="customers/activeorder">
                        Active Order
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="customers/pendingpayment">
                        Pending Payment
                    </NavLink>
                </div>
            </div>

            <!-- Batches with sub-links -->
            <div class="nav-item-group">
                <NavLink class="nav-link text-light collapsible-nav-link" href="batches" @onclick='() => ToggleSubMenu("batches")'>
                    Batches
                </NavLink>
                <div class="sub-menu @(IsSubMenuOpen("batches") ? "sub-menu-open" : "")">
                    <NavLink class="nav-link text-light sub-nav-link" href="batches/placeholder1">
                        Placeholder 1
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="batches/placeholder2">
                        Placeholder 2
                    </NavLink>
                </div>
            </div>

            <!-- Production with sub-links -->
            <div class="nav-item-group">
                <NavLink class="nav-link text-light collapsible-nav-link" href="production" @onclick='() => ToggleSubMenu("production")'>
                    Production
                </NavLink>
                <div class="sub-menu @(IsSubMenuOpen("production") ? "sub-menu-open" : "")">
                    <NavLink class="nav-link text-light sub-nav-link" href="production/placeholder1">
                        Placeholder 1
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="production/placeholder2">
                        Placeholder 2
                    </NavLink>
                </div>
            </div>
        </div>
    </div>
</nav>

@code {
    private Dictionary<string, bool> _openSubMenus = new Dictionary<string, bool>();

    /// <summary>
    /// Toggles the specified submenu while ensuring only one submenu can be open at a time.
    /// This implements the requirement that clicking a new main link collapses any open submenu.
    /// </summary>
    /// <param name="menuId">The identifier of the menu to toggle</param>
    private void ToggleSubMenu(string menuId)
    {
        // Check if this menu is currently open
        bool isCurrentlyOpen = _openSubMenus.ContainsKey(menuId) && _openSubMenus[menuId];
        
        // Close all submenus first to ensure only one can be open at a time
        _openSubMenus.Clear();
        
        // If the clicked menu was not open, open it now
        if (!isCurrentlyOpen)
        {
            _openSubMenus[menuId] = true;
        }
    }

    /// <summary>
    /// Checks if the specified submenu is currently open.
    /// </summary>
    /// <param name="menuId">The identifier of the menu to check</param>
    /// <returns>True if the submenu is open, false otherwise</returns>
    private bool IsSubMenuOpen(string menuId)
    {
        return _openSubMenus.ContainsKey(menuId) && _openSubMenus[menuId];
    }
}