<!-- Material Admin Pro drawer navigation -->
<nav class="drawer accordion drawer-dark bg-dark text-light" id="drawerAccordion">
    <div class="drawer-menu">
        <div class="nav">
            <!-- Home/Dashboard -->
            <NavLink class="nav-link text-light" href="/" Match="NavLinkMatch.All">
                Home
            </NavLink>

            <!-- Items with sub-links -->
            <div class="nav-item-group">
                <button class="nav-link text-light collapsible-nav-link" @onclick='() => ToggleSubMenu("items")' type="button">
                    Items
                </button>
                <div class="sub-menu @(IsSubMenuOpen("items") ? "sub-menu-open" : "")">
                    <NavLink class="nav-link text-light sub-nav-link" href="items/threadless">
                        Threadless
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="items/threaded">
                        Threaded
                    </NavLink>
                </div>
            </div>

            <!-- Orders with sub-links -->
            <div class="nav-item-group">
                <button class="nav-link text-light collapsible-nav-link" @onclick='() => ToggleSubMenu("orders")' type="button">
                    Orders
                </button>
                <div class="sub-menu @(IsSubMenuOpen("orders") ? "sub-menu-open" : "")">
                    <NavLink class="nav-link text-light sub-nav-link" href="orders/pulllist">
                        Pull List
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="orders/labels">
                        Labels
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="orders/assign">
                        Assign
                    </NavLink>
                </div>
            </div>

            <!-- Customers with sub-links -->
            <div class="nav-item-group">
                <button class="nav-link text-light collapsible-nav-link" @onclick='() => ToggleSubMenu("customers")' type="button">
                    Customers
                </button>
                <div class="sub-menu @(IsSubMenuOpen("customers") ? "sub-menu-open" : "")">
                    <NavLink class="nav-link text-light sub-nav-link" href="customers/activeorder">
                        Active Order
                    </NavLink>
                    <NavLink class="nav-link text-light sub-nav-link" href="customers/pendingpayment">
                        Pending Payment
                    </NavLink>
                </div>
            </div>

            <!-- Batches -->
            <NavLink class="nav-link text-light" href="batches">
                Batches
            </NavLink>

            <!-- Production -->
            <NavLink class="nav-link text-light" href="production">
                Production
            </NavLink>
        </div>
    </div>
</nav>

@code {
    private Dictionary<string, bool> _openSubMenus = new Dictionary<string, bool>();

    /// <summary>
    /// Toggles the specified submenu while ensuring only one submenu can be open at a time.
    /// This implements the requirement that clicking a new main link collapses any open submenu.
    /// </summary>
    /// <param name="menuId">The identifier of the menu to toggle</param>
    private void ToggleSubMenu(string menuId)
    {
        // Check if this menu is currently open
        bool isCurrentlyOpen = _openSubMenus.ContainsKey(menuId) && _openSubMenus[menuId];
        
        // Close all submenus first to ensure only one can be open at a time
        _openSubMenus.Clear();
        
        // If the clicked menu was not open, open it now
        if (!isCurrentlyOpen)
        {
            _openSubMenus[menuId] = true;
        }
    }

    /// <summary>
    /// Checks if the specified submenu is currently open.
    /// </summary>
    /// <param name="menuId">The identifier of the menu to check</param>
    /// <returns>True if the submenu is open, false otherwise</returns>
    private bool IsSubMenuOpen(string menuId)
    {
        return _openSubMenus.ContainsKey(menuId) && _openSubMenus[menuId];
    }
}